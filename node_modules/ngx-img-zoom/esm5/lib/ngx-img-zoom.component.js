/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Renderer2, ElementRef, ViewChild, Input, HostListener } from '@angular/core';
import { NgxImgZoomService } from './ngx-img-zoom.service';
var NgxImgZoomComponent = /** @class */ (function () {
    function NgxImgZoomComponent(renderer, ngxZoomService) {
        this.renderer = renderer;
        this.ngxZoomService = ngxZoomService;
        this.hide = true;
        this._triggerAnimationIn = false;
        this.notFirstTime = false;
        this.showResult = false;
        this.zoomMode = this.ngxZoomService.zoomMode;
    }
    Object.defineProperty(NgxImgZoomComponent.prototype, "imgStyle", {
        get: /**
         * @return {?}
         */
        function () {
            return this._imgStyle;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._imgStyle = val;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgxImgZoomComponent.prototype, "resultStyle", {
        get: /**
         * @return {?}
         */
        function () {
            return this._resultStyle;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._resultStyle = val;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgxImgZoomComponent.prototype, "lensStyle", {
        get: /**
         * @return {?}
         */
        function () {
            return this._lensStyle;
        },
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this._lensStyle = val;
            if (this.notFirstTime) {
                this.imageZoom();
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} event
     * @return {?}
     */
    NgxImgZoomComponent.prototype.onscroll = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.hide = true;
        this.renderer.setStyle(this.lens, 'visibility', 'hidden');
    };
    /**
     * @param {?} event
     * @return {?}
     */
    NgxImgZoomComponent.prototype.onclick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.hide = true;
        this.renderer.setStyle(this.lens, 'visibility', 'hidden');
    };
    Object.defineProperty(NgxImgZoomComponent.prototype, "_imgSrc", {
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            this.zoomImage = val;
            if (this.notFirstTime === true) {
                this.renderer.setStyle(this.result, 'backgroundImage', "url('" + val + "')");
            }
            this.notFirstTime = true;
            // this.renderer.setStyle(this.result, 'backgroundImage', val);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NgxImgZoomComponent.prototype, "_zoomImage", {
        set: /**
         * @param {?} val
         * @return {?}
         */
        function (val) {
            var _this = this;
            this.previewImage = val;
            this.showResult = false;
            /** @type {?} */
            var image = new Image();
            image.src = this.zoomImage;
            image.onload = (/**
             * @return {?}
             */
            function () {
                _this.showResult = true;
            });
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NgxImgZoomComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
    };
    /**
     * @return {?}
     */
    NgxImgZoomComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.img = this.imgElmRef.nativeElement;
        this.result = this.resultElmRef.nativeElement;
        this.container = this.containerElmRef.nativeElement;
        this.renderer.setAttribute(this.img, 'style', (/** @type {?} */ (this.imgStyle)));
        this.renderer.setAttribute(this.result, 'style', (/** @type {?} */ (this.resultStyle)));
        this.renderer.setAttribute(this.container, 'style', (/** @type {?} */ (this.containerStyle)));
        this.imageZoom();
        this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        this.renderer.listen(this.img, 'mouseout', (/**
         * @return {?}
         */
        function () {
            _this.hide = true;
            _this.renderer.setStyle(_this.lens, 'visibility', 'hidden');
        }));
    };
    /**
     * @return {?}
     */
    NgxImgZoomComponent.prototype.imageZoom = /**
     * @return {?}
     */
    function () {
        /*create lens:*/
        this.lens = this.renderer.createElement('DIV');
        this.renderer.addClass(this.lens, 'img-zoom-lens');
        this.renderer.setAttribute(this.lens, 'style', (/** @type {?} */ (this.lensStyle)));
        /*insert lens:*/
        this.renderer.insertBefore(this.img.parentElement, this.lens, this.img);
        /*calculate the ratio between result DIV and lens:*/
        this.cx = this.result.offsetWidth / this.lens.offsetWidth;
        this.cy = this.result.offsetHeight / this.lens.offsetHeight;
        /*set background properties for the result DIV:*/
        this.renderer.setStyle(this.result, 'backgroundImage', "url('" + this.zoomImage + "')");
        this.renderer.setStyle(this.result, 'backgroundSize', (this.img.width * this.cx) + 'px ' + (this.img.height * this.cy) + 'px');
        // this.renderer.setStyle(this.img.parentElement, 'position', 'relative')
        /*execute a function when someone moves the cursor over the image, or the lens:*/
        this.renderer.listen(this.lens, 'mousemove', this.moveLens.bind(this));
        this.renderer.listen(this.img, 'mousemove', this.moveLens.bind(this));
        /*and also for touch screens:*/
        this.renderer.listen(this.img, 'touchmove', this.moveLens.bind(this));
        this.renderer.listen(this.lens, 'touchmove', this.moveLens.bind(this));
    };
    /**
     * @param {?} e
     * @return {?}
     */
    NgxImgZoomComponent.prototype.moveLens = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        /** @type {?} */
        var pos;
        /** @type {?} */
        var x;
        /** @type {?} */
        var y;
        /*prevent any other actions that may occur when moving over the image:*/
        e.preventDefault();
        /*get the cursor's x and y positions:*/
        pos = this.getCursorPos(e);
        /*calculate the position of the lens:*/
        x = pos.x - (this.lens.offsetWidth / 2);
        y = pos.y - (this.lens.offsetHeight / 2);
        /*prevent the lens from being positioned outside the image:*/
        if (x > this.img.width - this.lens.offsetWidth) {
            x = this.img.width - this.lens.offsetWidth;
            this.hide = true;
            this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        }
        else {
            this.hide = false;
            if (this.showResult) {
                this.renderer.setStyle(this.lens, 'visibility', 'visible');
            }
        }
        if (x < 0) {
            x = 0;
            this.hide = true;
            this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        }
        if (y > this.img.height - this.lens.offsetHeight) {
            y = this.img.height - this.lens.offsetHeight;
            this.hide = true;
            this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        }
        if (y < 0) {
            y = 0;
            this.hide = true;
            this.renderer.setStyle(this.lens, 'visibility', 'hidden');
        }
        /*set the position of the lens:*/
        this.renderer.setStyle(this.lens, 'left', x + 'px');
        this.renderer.setStyle(this.lens, 'top', y + 'px');
        /*display what the lens 'sees':*/
        this.renderer.setStyle(this.result, 'backgroundPosition', '-' + (x * this.cx) + 'px -' + (y * this.cy) + 'px');
    };
    /**
     * @param {?} e
     * @return {?}
     */
    NgxImgZoomComponent.prototype.getCursorPos = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        /** @type {?} */
        var a;
        /** @type {?} */
        var x = 0;
        /** @type {?} */
        var y = 0;
        e = e || window.event;
        /*get the x and y positions of the image:*/
        a = this.img.getBoundingClientRect();
        /*calculate the cursor's x and y coordinates, relative to the image:*/
        x = e.pageX - a.left;
        y = e.pageY - a.top;
        /*consider any page scrolling:*/
        x = x - window.pageXOffset;
        y = y - window.pageYOffset;
        return { x: x, y: y };
    };
    /**
     * @return {?}
     */
    NgxImgZoomComponent.prototype.handleMouseLeave = /**
     * @return {?}
     */
    function () {
        this.hide = true;
        this.renderer.setStyle(this.lens, 'visibility', 'hidden');
    };
    NgxImgZoomComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ngx-img-zoom',
                    template: "<div  class=\"img-zoom-container\" #container>\n    <img id=\"myimage\" [src]=\"previewImage\" #img (mouseleave)=\"handleMouseLeave()\">\n    <div [ngClass]=\"{'hide': hide || !showResult}\" \n        id=\"myresult\" \n        class=\"img-zoom-result\" \n        #result>\n    </div>\n</div>  ",
                    styles: ["*{box-sizing:border-box}.img-zoom-container{position:absolute}.img-zoom-lens{position:absolute;border:1px solid #d4d4d4;width:40px;height:40px}.img-zoom-result{border:1px solid #d4d4d4;width:300px;height:300px}.hide{visibility:hidden}"]
                }] }
    ];
    /** @nocollapse */
    NgxImgZoomComponent.ctorParameters = function () { return [
        { type: Renderer2 },
        { type: NgxImgZoomService }
    ]; };
    NgxImgZoomComponent.propDecorators = {
        imgElmRef: [{ type: ViewChild, args: ['img',] }],
        resultElmRef: [{ type: ViewChild, args: ['result',] }],
        containerElmRef: [{ type: ViewChild, args: ['container',] }],
        imgStyle: [{ type: Input }],
        resultStyle: [{ type: Input }],
        lensStyle: [{ type: Input }],
        containerStyle: [{ type: Input }],
        onscroll: [{ type: HostListener, args: ['window:scroll', ['$event'],] }],
        onclick: [{ type: HostListener, args: ['window:click', ['$event.target'],] }],
        _imgSrc: [{ type: Input, args: ['zoomImageSrc',] }],
        _zoomImage: [{ type: Input, args: ['previewImageSrc',] }]
    };
    return NgxImgZoomComponent;
}());
export { NgxImgZoomComponent };
if (false) {
    /** @type {?} */
    NgxImgZoomComponent.prototype.img;
    /** @type {?} */
    NgxImgZoomComponent.prototype.lens;
    /** @type {?} */
    NgxImgZoomComponent.prototype.result;
    /** @type {?} */
    NgxImgZoomComponent.prototype.cx;
    /** @type {?} */
    NgxImgZoomComponent.prototype.cy;
    /** @type {?} */
    NgxImgZoomComponent.prototype.container;
    /** @type {?} */
    NgxImgZoomComponent.prototype.hide;
    /** @type {?} */
    NgxImgZoomComponent.prototype._triggerAnimationIn;
    /** @type {?} */
    NgxImgZoomComponent.prototype.notFirstTime;
    /** @type {?} */
    NgxImgZoomComponent.prototype.showResult;
    /** @type {?} */
    NgxImgZoomComponent.prototype.zoomMode;
    /** @type {?} */
    NgxImgZoomComponent.prototype.imgElmRef;
    /** @type {?} */
    NgxImgZoomComponent.prototype.resultElmRef;
    /** @type {?} */
    NgxImgZoomComponent.prototype.containerElmRef;
    /** @type {?} */
    NgxImgZoomComponent.prototype._imgStyle;
    /** @type {?} */
    NgxImgZoomComponent.prototype._resultStyle;
    /** @type {?} */
    NgxImgZoomComponent.prototype._lensStyle;
    /** @type {?} */
    NgxImgZoomComponent.prototype.containerStyle;
    /** @type {?} */
    NgxImgZoomComponent.prototype.zoomImage;
    /** @type {?} */
    NgxImgZoomComponent.prototype.previewImage;
    /**
     * @type {?}
     * @private
     */
    NgxImgZoomComponent.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    NgxImgZoomComponent.prototype.ngxZoomService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWltZy16b29tLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25neC1pbWctem9vbS8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtaW1nLXpvb20uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLFNBQVMsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFpQixLQUFLLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hILE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBRTNEO0lBWUUsNkJBQ1UsUUFBbUIsRUFDbkIsY0FBaUM7UUFEakMsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNuQixtQkFBYyxHQUFkLGNBQWMsQ0FBbUI7UUFOM0MsU0FBSSxHQUFHLElBQUksQ0FBQztRQUNaLHdCQUFtQixHQUFHLEtBQUssQ0FBQztRQUM1QixpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUNyQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBTWpCLGFBQVEsR0FBbUIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUM7SUFGcEQsQ0FBQztJQVNMLHNCQUFhLHlDQUFROzs7O1FBR3JCO1lBQ0UsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ3hCLENBQUM7Ozs7O1FBTEQsVUFBc0IsR0FBRztZQUN2QixJQUFJLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztRQUN2QixDQUFDOzs7T0FBQTtJQU1ELHNCQUFhLDRDQUFXOzs7O1FBR3hCO1lBQ0UsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQzNCLENBQUM7Ozs7O1FBTEQsVUFBeUIsR0FBRztZQUMxQixJQUFJLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQztRQUMxQixDQUFDOzs7T0FBQTtJQU1ELHNCQUFhLDBDQUFTOzs7O1FBTXRCO1lBQ0UsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3pCLENBQUM7Ozs7O1FBUkQs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Qyx3Q0FBVTs7SUFDckMsbUNBQVk7O0lBQ1osa0RBQTRCOztJQUM1QiwyQ0FBcUI7O0lBQ3JCLHlDQUFtQjs7SUFNakIsdUNBQXdEOztJQUN4RCx3Q0FBd0M7O0lBQ3hDLDJDQUE4Qzs7SUFDOUMsOENBQW9EOztJQUdwRCx3Q0FBVTs7SUFRViwyQ0FBYTs7SUFRYix5Q0FBVzs7SUFVWCw2Q0FBd0I7O0lBQ3hCLHdDQUFVOztJQUNWLDJDQUFhOzs7OztJQXRDYix1Q0FBMkI7Ozs7O0lBQzNCLDZDQUF5QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBSZW5kZXJlcjIsIEVsZW1lbnRSZWYsIFZpZXdDaGlsZCwgQWZ0ZXJWaWV3SW5pdCwgSW5wdXQsIEhvc3RMaXN0ZW5lciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTmd4SW1nWm9vbVNlcnZpY2UgfSBmcm9tICcuL25neC1pbWctem9vbS5zZXJ2aWNlJztcbmltcG9ydCB7IE5neEltZ1pvb21Nb2RlIH0gZnJvbSAnLi9tb2RlLmVudW0nO1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWltZy16b29tJyxcbiAgdGVtcGxhdGVVcmw6ICcuL25neC1pbWctem9vbS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL25neC1pbWctem9vbS5jb21wb25lbnQuY3NzJ10sXG59KVxuZXhwb3J0IGNsYXNzIE5neEltZ1pvb21Db21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIEFmdGVyVmlld0luaXQge1xuXG4gIGltZzsgbGVuczsgcmVzdWx0OyBjeDsgY3k7IGNvbnRhaW5lcjtcbiAgaGlkZSA9IHRydWU7XG4gIF90cmlnZ2VyQW5pbWF0aW9uSW4gPSBmYWxzZTtcbiAgbm90Rmlyc3RUaW1lID0gZmFsc2U7XG4gIHNob3dSZXN1bHQgPSBmYWxzZTtcbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgbmd4Wm9vbVNlcnZpY2U6IE5neEltZ1pvb21TZXJ2aWNlXG4gICAgKSB7IH1cblxuICAgIHpvb21Nb2RlOiBOZ3hJbWdab29tTW9kZSA9IHRoaXMubmd4Wm9vbVNlcnZpY2Uuem9vbU1vZGU7XG4gICAgQFZpZXdDaGlsZCgnaW1nJykgaW1nRWxtUmVmOiBFbGVtZW50UmVmO1xuICAgIEBWaWV3Q2hpbGQoJ3Jlc3VsdCcpIHJlc3VsdEVsbVJlZjogRWxlbWVudFJlZjtcbiAgICBAVmlld0NoaWxkKCdjb250YWluZXInKSBjb250YWluZXJFbG1SZWY6IEVsZW1lbnRSZWY7XG5cblxuICAgIF9pbWdTdHlsZTtcbiAgICBASW5wdXQoKSBzZXQgaW1nU3R5bGUodmFsKSB7XG4gICAgICB0aGlzLl9pbWdTdHlsZSA9IHZhbDtcbiAgICB9XG4gICAgZ2V0IGltZ1N0eWxlKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2ltZ1N0eWxlO1xuICAgIH1cblxuICAgIF9yZXN1bHRTdHlsZTtcbiAgICBASW5wdXQoKSBzZXQgcmVzdWx0U3R5bGUodmFsKSB7XG4gICAgICB0aGlzLl9yZXN1bHRTdHlsZSA9IHZhbDtcbiAgICB9XG4gICAgZ2V0IHJlc3VsdFN0eWxlKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX3Jlc3VsdFN0eWxlO1xuICAgIH1cblxuICAgIF9sZW5zU3R5bGU7XG4gICAgQElucHV0KCkgc2V0IGxlbnNTdHlsZSh2YWwpIHtcbiAgICAgIHRoaXMuX2xlbnNTdHlsZSA9IHZhbDtcbiAgICAgIGlmICh0aGlzLm5vdEZpcnN0VGltZSkge1xuICAgICAgICB0aGlzLmltYWdlWm9vbSgpO1xuICAgICAgfVxuICAgIH1cbiAgICBnZXQgbGVuc1N0eWxlKCkge1xuICAgICAgcmV0dXJuIHRoaXMuX2xlbnNTdHlsZTtcbiAgICB9XG4gICAgQElucHV0KCkgY29udGFpbmVyU3R5bGU7XG4gICAgem9vbUltYWdlO1xuICAgIHByZXZpZXdJbWFnZTtcblxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6c2Nyb2xsJywgWyckZXZlbnQnXSkgb25zY3JvbGwoZXZlbnQpIHtcbiAgICB0aGlzLmhpZGUgPSB0cnVlO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgfVxuICBASG9zdExpc3RlbmVyKCd3aW5kb3c6Y2xpY2snLCBbJyRldmVudC50YXJnZXQnXSkgb25jbGljayhldmVudCkge1xuICAgIHRoaXMuaGlkZSA9IHRydWU7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxlbnMsICd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICB9XG5cbiAgQElucHV0KCd6b29tSW1hZ2VTcmMnKSBzZXQgX2ltZ1NyYyh2YWwpIHtcbiAgICB0aGlzLnpvb21JbWFnZSA9IHZhbDtcbiAgICBpZiAodGhpcy5ub3RGaXJzdFRpbWUgPT09IHRydWUpIHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5yZXN1bHQsICdiYWNrZ3JvdW5kSW1hZ2UnLCBcInVybCgnXCIgKyB2YWwgKyBcIicpXCIpO1xuICAgIH1cbiAgICB0aGlzLm5vdEZpcnN0VGltZSA9IHRydWU7XG4gICAgLy8gdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLnJlc3VsdCwgJ2JhY2tncm91bmRJbWFnZScsIHZhbCk7XG4gIH1cblxuICBASW5wdXQoJ3ByZXZpZXdJbWFnZVNyYycpIHNldCBfem9vbUltYWdlKHZhbCkge1xuICAgIHRoaXMucHJldmlld0ltYWdlID0gdmFsO1xuICAgIHRoaXMuc2hvd1Jlc3VsdCA9IGZhbHNlO1xuICAgIGNvbnN0IGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgaW1hZ2Uuc3JjID0gdGhpcy56b29tSW1hZ2U7XG4gICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgdGhpcy5zaG93UmVzdWx0ID0gdHJ1ZTtcbiAgICB9O1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgdGhpcy5pbWcgPSB0aGlzLmltZ0VsbVJlZi5uYXRpdmVFbGVtZW50O1xuICAgIHRoaXMucmVzdWx0ID0gdGhpcy5yZXN1bHRFbG1SZWYubmF0aXZlRWxlbWVudDtcbiAgICB0aGlzLmNvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyRWxtUmVmLm5hdGl2ZUVsZW1lbnQ7XG5cbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLmltZywgJ3N0eWxlJywgPHN0cmluZz50aGlzLmltZ1N0eWxlKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLnJlc3VsdCwgJ3N0eWxlJywgPHN0cmluZz50aGlzLnJlc3VsdFN0eWxlKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLmNvbnRhaW5lciwgJ3N0eWxlJywgPHN0cmluZz50aGlzLmNvbnRhaW5lclN0eWxlKTtcbiAgICB0aGlzLmltYWdlWm9vbSgpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmltZywgJ21vdXNlb3V0JywgKCkgPT4ge1xuICAgICAgdGhpcy5oaWRlID0gdHJ1ZTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgfSk7XG4gIH1cblxuXG4gIGltYWdlWm9vbSgpIHtcbiAgICAvKmNyZWF0ZSBsZW5zOiovXG4gICAgdGhpcy5sZW5zID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdESVYnKTtcbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMubGVucywgJ2ltZy16b29tLWxlbnMnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZSh0aGlzLmxlbnMsICdzdHlsZScsIDxzdHJpbmc+dGhpcy5sZW5zU3R5bGUpO1xuXG4gICAgLyppbnNlcnQgbGVuczoqL1xuICAgIHRoaXMucmVuZGVyZXIuaW5zZXJ0QmVmb3JlKHRoaXMuaW1nLnBhcmVudEVsZW1lbnQsIHRoaXMubGVucywgdGhpcy5pbWcpO1xuXG4gICAgLypjYWxjdWxhdGUgdGhlIHJhdGlvIGJldHdlZW4gcmVzdWx0IERJViBhbmQgbGVuczoqL1xuICAgIHRoaXMuY3ggPSB0aGlzLnJlc3VsdC5vZmZzZXRXaWR0aCAvIHRoaXMubGVucy5vZmZzZXRXaWR0aDtcbiAgICB0aGlzLmN5ID0gdGhpcy5yZXN1bHQub2Zmc2V0SGVpZ2h0IC8gdGhpcy5sZW5zLm9mZnNldEhlaWdodDtcblxuICAgIC8qc2V0IGJhY2tncm91bmQgcHJvcGVydGllcyBmb3IgdGhlIHJlc3VsdCBESVY6Ki9cbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMucmVzdWx0LCAnYmFja2dyb3VuZEltYWdlJywgXCJ1cmwoJ1wiICsgdGhpcy56b29tSW1hZ2UgKyBcIicpXCIpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5yZXN1bHQsICdiYWNrZ3JvdW5kU2l6ZScsICh0aGlzLmltZy53aWR0aCAqIHRoaXMuY3gpICsgJ3B4ICcgKyAodGhpcy5pbWcuaGVpZ2h0ICogdGhpcy5jeSkgKyAncHgnKTtcbiAgICAvLyB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMuaW1nLnBhcmVudEVsZW1lbnQsICdwb3NpdGlvbicsICdyZWxhdGl2ZScpXG5cbiAgICAvKmV4ZWN1dGUgYSBmdW5jdGlvbiB3aGVuIHNvbWVvbmUgbW92ZXMgdGhlIGN1cnNvciBvdmVyIHRoZSBpbWFnZSwgb3IgdGhlIGxlbnM6Ki9cbiAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmxlbnMsICdtb3VzZW1vdmUnLCB0aGlzLm1vdmVMZW5zLmJpbmQodGhpcykpO1xuICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHRoaXMuaW1nLCAnbW91c2Vtb3ZlJywgdGhpcy5tb3ZlTGVucy5iaW5kKHRoaXMpKTtcblxuICAgIC8qYW5kIGFsc28gZm9yIHRvdWNoIHNjcmVlbnM6Ki9cbiAgICB0aGlzLnJlbmRlcmVyLmxpc3Rlbih0aGlzLmltZywgJ3RvdWNobW92ZScsIHRoaXMubW92ZUxlbnMuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5yZW5kZXJlci5saXN0ZW4odGhpcy5sZW5zLCAndG91Y2htb3ZlJywgdGhpcy5tb3ZlTGVucy5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIG1vdmVMZW5zKGUpIHtcbiAgICAgIGxldCBwb3MsIHgsIHk7XG4gICAgICAvKnByZXZlbnQgYW55IG90aGVyIGFjdGlvbnMgdGhhdCBtYXkgb2NjdXIgd2hlbiBtb3Zpbmcgb3ZlciB0aGUgaW1hZ2U6Ki9cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIC8qZ2V0IHRoZSBjdXJzb3IncyB4IGFuZCB5IHBvc2l0aW9uczoqL1xuICAgICAgcG9zID0gdGhpcy5nZXRDdXJzb3JQb3MoZSk7XG4gICAgICAvKmNhbGN1bGF0ZSB0aGUgcG9zaXRpb24gb2YgdGhlIGxlbnM6Ki9cbiAgICAgIHggPSBwb3MueCAtICh0aGlzLmxlbnMub2Zmc2V0V2lkdGggLyAyKTtcbiAgICAgIHkgPSBwb3MueSAtICh0aGlzLmxlbnMub2Zmc2V0SGVpZ2h0IC8gMik7XG5cblxuICAgICAgLypwcmV2ZW50IHRoZSBsZW5zIGZyb20gYmVpbmcgcG9zaXRpb25lZCBvdXRzaWRlIHRoZSBpbWFnZToqL1xuICAgICAgaWYgKHggPiB0aGlzLmltZy53aWR0aCAtIHRoaXMubGVucy5vZmZzZXRXaWR0aCkge1xuICAgICAgICB4ID0gdGhpcy5pbWcud2lkdGggLSB0aGlzLmxlbnMub2Zmc2V0V2lkdGg7XG5cbiAgICAgICAgdGhpcy5oaWRlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxlbnMsICd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oaWRlID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLnNob3dSZXN1bHQpIHtcbiAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMubGVucywgJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh4IDwgMCkge1xuICAgICAgICB4ID0gMDtcbiAgICAgICAgdGhpcy5oaWRlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxlbnMsICd2aXNpYmlsaXR5JywgJ2hpZGRlbicpO1xuICAgICAgfVxuXG4gICAgICBpZiAoeSA+IHRoaXMuaW1nLmhlaWdodCAtIHRoaXMubGVucy5vZmZzZXRIZWlnaHQpIHtcbiAgICAgICAgeSA9IHRoaXMuaW1nLmhlaWdodCAtIHRoaXMubGVucy5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIHRoaXMuaGlkZSA9IHRydWU7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHkgPCAwKSB7XG4gICAgICAgIHkgPSAwO1xuICAgICAgICB0aGlzLmhpZGUgPSB0cnVlO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKHRoaXMubGVucywgJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICB9XG5cbiAgICAgIC8qc2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgbGVuczoqL1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxlbnMsICdsZWZ0JywgeCArICdweCcpO1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZSh0aGlzLmxlbnMsICd0b3AnLCB5ICsgJ3B4Jyk7XG4gICAgICAvKmRpc3BsYXkgd2hhdCB0aGUgbGVucyAnc2Vlcyc6Ki9cbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5yZXN1bHQsICdiYWNrZ3JvdW5kUG9zaXRpb24nLCAnLScgKyAoeCAqIHRoaXMuY3gpICsgJ3B4IC0nICsgKHkgKiB0aGlzLmN5KSArICdweCcpO1xuICAgIH1cblxuICBnZXRDdXJzb3JQb3MoZSkge1xuICAgICAgbGV0IGEsIHggPSAwLCB5ID0gMDtcbiAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgICAgIC8qZ2V0IHRoZSB4IGFuZCB5IHBvc2l0aW9ucyBvZiB0aGUgaW1hZ2U6Ki9cbiAgICAgIGEgPSB0aGlzLmltZy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIC8qY2FsY3VsYXRlIHRoZSBjdXJzb3IncyB4IGFuZCB5IGNvb3JkaW5hdGVzLCByZWxhdGl2ZSB0byB0aGUgaW1hZ2U6Ki9cbiAgICAgIHggPSBlLnBhZ2VYIC0gYS5sZWZ0O1xuICAgICAgeSA9IGUucGFnZVkgLSBhLnRvcDtcbiAgICAgIC8qY29uc2lkZXIgYW55IHBhZ2Ugc2Nyb2xsaW5nOiovXG4gICAgICB4ID0geCAtIHdpbmRvdy5wYWdlWE9mZnNldDtcbiAgICAgIHkgPSB5IC0gd2luZG93LnBhZ2VZT2Zmc2V0O1xuICAgICAgcmV0dXJuIHt4IDogeCwgeSA6IHl9O1xuICB9XG5cbiAgaGFuZGxlTW91c2VMZWF2ZSgpIHtcbiAgICB0aGlzLmhpZGUgPSB0cnVlO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUodGhpcy5sZW5zLCAndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgfVxuXG59XG4iXX0=